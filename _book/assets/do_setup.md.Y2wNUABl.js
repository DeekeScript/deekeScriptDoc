import{_ as s,c as e,o as a,ah as n}from"./chunks/framework.DqceGHDO.js";const d=JSON.parse('{"title":"Device Owner模式 - 开启指南","description":"DeekeScript - Device Owner模式开启指南","frontmatter":{"title":"Device Owner模式 - 开启指南","description":"DeekeScript - Device Owner模式开启指南"},"headers":[],"relativePath":"do/setup.md","filePath":"do/setup.md"}'),l={name:"do/setup.md"};function r(t,i,p,h,o,k){return a(),e("div",null,i[0]||(i[0]=[n(`<h1 id="deviceowner模式开启指南" tabindex="-1">Device Owner模式 - 开启指南 <a class="header-anchor" href="#deviceowner模式开启指南" aria-label="Permalink to “Device Owner模式 - 开启指南”">​</a></h1><p>本文档介绍如何将DeekeScript应用或使用DeekeScript打包后的App设置为Device Owner（设备所有者）。</p><blockquote><p><strong>重要说明</strong>：不仅DeekeScript应用可以设置为Device Owner，使用DeekeScript打包后的App也可以设置为Device Owner。设置时只需要将命令中的包名替换为你打包后的App包名即可。</p></blockquote><h2 id="前提条件" tabindex="-1">前提条件 <a class="header-anchor" href="#前提条件" aria-label="Permalink to “前提条件”">​</a></h2><p>在开始之前，请确保：</p><ol><li><strong>设备状态</strong> - 设备必须是<strong>未激活状态</strong>（首次启动）或需要<strong>恢复出厂设置</strong></li><li><strong>Android版本</strong> - Android 8.0 (API 26) 及以上版本</li><li><strong>ADB权限</strong> - 你需要有设备的ADB调试权限</li><li><strong>USB调试</strong> - 设备需要开启USB调试模式</li></ol><blockquote><p><strong>重要提示</strong>：</p><ul><li>Device Owner只能在设备未激活时设置。如果设备已经激活，必须先恢复出厂设置。</li><li><strong>每台设备只能设置一个应用为Device Owner模式</strong>。如果设备上已有Device Owner，必须先恢复出厂设置才能设置新的Device Owner。</li><li><strong>必须删除所有用户账户</strong>：设置Device Owner前，需要删除设备上的所有用户账户（包括Google账户、小米账户、华为账户等）。如果设备已登录账号，需要先退出所有账号或恢复出厂设置。</li></ul></blockquote><h2 id="通过adb命令设置" tabindex="-1">通过ADB命令设置 <a class="header-anchor" href="#通过adb命令设置" aria-label="Permalink to “通过ADB命令设置”">​</a></h2><p>这是最常用的方法，适用于开发和测试环境。</p><h3 id="步骤1准备设备" tabindex="-1">步骤1：准备设备 <a class="header-anchor" href="#步骤1准备设备" aria-label="Permalink to “步骤1：准备设备”">​</a></h3><ol><li><p><strong>恢复出厂设置</strong>（如果设备已激活）</p><ul><li>进入设备设置 → 系统 → 重置选项 → 恢复出厂设置</li><li>或通过Recovery模式恢复出厂设置</li><li><strong>注意</strong>：恢复出厂设置会自动清除所有账户，这是设置Device Owner的必要步骤</li></ul></li><li><p><strong>退出所有账户</strong>（如果设备已激活但未恢复出厂设置）</p><ul><li>进入设备设置 → 账户</li><li>删除所有已登录的账户（Google账户、小米账户、华为账户等）</li><li>如果设备启用了多用户模式、访客模式或应用双开，也需要关闭或删除这些功能</li><li><strong>建议</strong>：如果设备已激活，直接恢复出厂设置是最简单的方法</li><li><strong>小米手机特殊说明</strong>：小米手机可能需要先登录小米账号才能通过adb执行命令，但设置Device Owner又需要退出小米账号。如果遇到这种情况，建议： <ul><li>先登录小米账号，完成adb授权等准备工作</li><li>在执行Device Owner设置命令前，退出小米账号</li><li>然后再执行adb设置Device Owner命令</li></ul></li></ul></li><li><p><strong>开启开发者选项</strong></p><ul><li>进入设备设置 → 关于手机</li><li>连续点击&quot;版本号&quot;7次</li><li>返回设置，找到&quot;开发者选项&quot;</li></ul></li><li><p><strong>开启USB调试</strong></p><ul><li>进入开发者选项</li><li>开启&quot;USB调试&quot;</li></ul></li><li><p><strong>连接电脑</strong></p><ul><li>使用USB线连接设备到电脑</li><li>在设备上允许USB调试授权</li></ul></li></ol><h3 id="步骤2获取应用包名和receiver类名" tabindex="-1">步骤2：获取应用包名和Receiver类名 <a class="header-anchor" href="#步骤2获取应用包名和receiver类名" aria-label="Permalink to “步骤2：获取应用包名和Receiver类名”">​</a></h3><p><strong>DeekeScript应用的Device Owner Receiver信息：</strong></p><ul><li><strong>包名</strong>: <code>com.android.deeke.script</code></li><li><strong>Receiver类名</strong>: <code>top.deeke.script.service.AdminReceiver</code></li></ul><blockquote><p><strong>提示</strong>：如果你使用的是打包后的App，需要将包名替换为你打包后的App包名。Receiver类名保持不变，因为打包后的App会继承DeekeScript的Device Owner Receiver配置。</p></blockquote><h3 id="步骤3执行adb命令" tabindex="-1">步骤3：执行ADB命令 <a class="header-anchor" href="#步骤3执行adb命令" aria-label="Permalink to “步骤3：执行ADB命令”">​</a></h3><blockquote><p><strong>小米手机注意事项</strong>：如果是小米手机，adb调试相关设置可能需要登录小米账号，相关设置打开后，再退出账号，最后执行下面的命令。</p></blockquote><p>在电脑上打开终端/命令提示符，执行以下命令：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">adb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-device-owner</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">com.android.deeke.script/top.deeke.script.service.AdminReceiver</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="步骤4验证设置" tabindex="-1">步骤4：验证设置 <a class="header-anchor" href="#步骤4验证设置" aria-label="Permalink to “步骤4：验证设置”">​</a></h3><p>执行命令后，如果看到类似以下输出，说明设置成功：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Success: Device owner set to package com.android.deeke.script</span></span>
<span class="line"><span>Active admin set to component {com.android.deeke.script/top.deeke.script.service.AdminReceiver}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="步骤5在代码中验证" tabindex="-1">步骤5：在代码中验证 <a class="header-anchor" href="#步骤5在代码中验证" aria-label="Permalink to “步骤5：在代码中验证”">​</a></h3><p>在DeekeScript脚本中验证Device Owner状态：</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (DevicePolicy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDeviceOwner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;✅ Device Owner设置成功！&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;❌ Device Owner设置失败，请检查设置步骤&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to “常见问题”">​</a></h2><h3 id="q1提示errorcantsetpackageasdeviceownerbecauseitsalreadyadeviceownerorprofileowner" tabindex="-1">Q1: 提示&quot;Error: Can&#39;t set package as device owner because it&#39;s already a device owner or profile owner&quot; <a class="header-anchor" href="#q1提示errorcantsetpackageasdeviceownerbecauseitsalreadyadeviceownerorprofileowner" aria-label="Permalink to “Q1: 提示&quot;Error: Can&#39;t set package as device owner because it&#39;s already a device owner or profile owner&quot;”">​</a></h3><p><strong>原因</strong>：设备上已经存在Device Owner或Profile Owner。</p><p><strong>解决方法</strong>：</p><ul><li>恢复出厂设置</li><li>或者移除现有的Device Owner（需要恢复出厂设置）</li></ul><h3 id="q2提示errorcantsetpackageasdeviceownerbecausethedeviceisalreadysetup" tabindex="-1">Q2: 提示&quot;Error: Can&#39;t set package as device owner because the device is already set up&quot; <a class="header-anchor" href="#q2提示errorcantsetpackageasdeviceownerbecausethedeviceisalreadysetup" aria-label="Permalink to “Q2: 提示&quot;Error: Can&#39;t set package as device owner because the device is already set up&quot;”">​</a></h3><p><strong>原因</strong>：设备已经激活，Device Owner只能在未激活的设备上设置。</p><p><strong>解决方法</strong>：</p><ul><li>恢复出厂设置</li><li>在恢复出厂设置后，不要完成设置向导，直接通过ADB设置</li></ul><h3 id="q3提示errordeviceownercomponentcannotbefound" tabindex="-1">Q3: 提示&quot;Error: Device owner component cannot be found&quot; <a class="header-anchor" href="#q3提示errordeviceownercomponentcannotbefound" aria-label="Permalink to “Q3: 提示&quot;Error: Device owner component cannot be found&quot;”">​</a></h3><p><strong>原因</strong>：应用未安装或Receiver类名不正确。</p><p><strong>解决方法</strong>：</p><ul><li>确认应用已正确安装</li><li>检查包名和Receiver类名是否正确</li><li>确认AndroidManifest.xml中已正确声明Receiver</li></ul><h3 id="q4设置后应用被卸载了怎么办" tabindex="-1">Q4: 设置后应用被卸载了怎么办？ <a class="header-anchor" href="#q4设置后应用被卸载了怎么办" aria-label="Permalink to “Q4: 设置后应用被卸载了怎么办？”">​</a></h3><p><strong>原因</strong>：设备恢复出厂设置会清除所有应用。</p><p><strong>解决方法</strong>：</p><ul><li>重新安装应用</li><li>Device Owner设置会在恢复出厂设置后清除，需要重新设置</li></ul><h3 id="q5如何移除deviceowner" tabindex="-1">Q5: 如何移除Device Owner？ <a class="header-anchor" href="#q5如何移除deviceowner" aria-label="Permalink to “Q5: 如何移除Device Owner？”">​</a></h3><p><strong>方法</strong>：</p><ul><li>唯一的方法是恢复出厂设置</li><li>Device Owner权限一旦授予，无法通过常规方法移除</li><li>这是Android系统的安全机制</li></ul><h3 id="q6设备已经激活不想恢复出厂设置怎么办" tabindex="-1">Q6: 设备已经激活，不想恢复出厂设置怎么办？ <a class="header-anchor" href="#q6设备已经激活不想恢复出厂设置怎么办" aria-label="Permalink to “Q6: 设备已经激活，不想恢复出厂设置怎么办？”">​</a></h3><p><strong>抱歉</strong>：如果设备已经激活，必须恢复出厂设置才能设置Device Owner。这是Android系统的限制，无法绕过。</p><h2 id="验证deviceowner功能" tabindex="-1">验证Device Owner功能 <a class="header-anchor" href="#验证deviceowner功能" aria-label="Permalink to “验证Device Owner功能”">​</a></h2><p>设置成功后，你可以测试以下功能：</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. 检查Device Owner状态</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (DevicePolicy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDeviceOwner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Device Owner状态: ✅ 已设置&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. 测试锁屏功能</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DevicePolicy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lockNow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DevicePolicy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wakeScreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. 测试应用管理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> packages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Device.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInstalledPackages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;已安装应用数量:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, packages.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. 测试硬件控制</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DeviceHardware.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setScreenCaptureDisabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;截屏功能已禁用&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Device Owner状态: ❌ 未设置&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;请按照开启指南设置Device Owner&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="生产环境注意事项" tabindex="-1">生产环境注意事项 <a class="header-anchor" href="#生产环境注意事项" aria-label="Permalink to “生产环境注意事项”">​</a></h2><p>在生产环境中使用Device Owner模式时，请注意：</p><ol><li><strong>设备采购</strong> - 采购时选择支持Device Owner的设备</li><li><strong>初始化流程</strong> - 制定标准的设备初始化流程</li><li><strong>备份数据</strong> - 设置Device Owner前备份重要数据</li><li><strong>测试验证</strong> - 在批量部署前，充分测试所有功能</li><li><strong>文档记录</strong> - 记录每个设备的Device Owner设置时间</li></ol><h2 id="相关文档" tabindex="-1">相关文档 <a class="header-anchor" href="#相关文档" aria-label="Permalink to “相关文档”">​</a></h2><ul><li><a href="./introduction.html">Device Owner模式介绍</a> - 了解Device Owner的基本概念</li><li><a href="./devicePolicy.html">DevicePolicy API文档</a> - DevicePolicy功能说明</li><li><a href="./deviceApp.html">DeviceApp API文档</a> - DeviceApp功能说明</li><li><a href="./deviceHardware.html">DeviceHardware API文档</a> - DeviceHardware功能说明</li><li><a href="./deviceKiosk.html">DeviceKiosk API文档</a> - DeviceKiosk功能说明</li></ul><h2 id="技术支持" tabindex="-1">技术支持 <a class="header-anchor" href="#技术支持" aria-label="Permalink to “技术支持”">​</a></h2><p>如果在设置过程中遇到问题，可以：</p><ol><li>查看设备的系统日志：<code>adb logcat | grep -i &quot;device.owner&quot;</code></li><li>检查应用的AndroidManifest.xml配置</li><li>确认设备的Android版本和制造商</li><li>参考Android官方文档：<a href="https://developer.android.com/work/dpc/build-device-owner" target="_blank" rel="noreferrer">https://developer.android.com/work/dpc/build-device-owner</a></li></ol>`,58)]))}const g=s(l,[["render",r]]);export{d as __pageData,g as default};
